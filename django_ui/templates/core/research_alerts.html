{% extends "core/base.html" %} {% load static %} {% block extra_css %}
<style>
  .alert-card {
    border-left: 4px solid #007bff;
    transition: transform 0.2s ease-in-out;
  }

  .alert-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .alert-card.inactive {
    opacity: 0.6;
    border-left-color: #6c757d;
  }

  .alert-frequency {
    background: linear-gradient(45deg, #007bff, #0056b3);
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .alert-type {
    background: #f8f9fa;
    color: #495057;
    padding: 2px 8px;
    border-radius: 8px;
    font-size: 0.75rem;
  }

  .create-alert-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
  }

  .btn-gradient {
    background: linear-gradient(45deg, #667eea, #764ba2);
    border: none;
    color: white;
    transition: all 0.3s ease;
  }

  .btn-gradient:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
    color: white;
  }

  .alert-status-toggle {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 25px;
  }

  .alert-status-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 25px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 19px;
    width: 19px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: #007bff;
  }

  input:checked + .slider:before {
    transform: translateX(25px);
  }
</style>
{% endblock %} {% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-bell me-2"></i>Research Alerts</h2>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
            <li class="breadcrumb-item active">Research Alerts</li>
          </ol>
        </nav>
      </div>

      <!-- Create New Alert Section -->
      <div class="create-alert-section">
        <h4 class="mb-3">
          <i class="fas fa-plus-circle me-2"></i>Create New Alert
        </h4>
        <form method="post" class="row g-3">
          {% csrf_token %}
          <input type="hidden" name="action" value="create" />

          <div class="col-md-6">
            <label for="title" class="form-label">Alert Title</label>
            <input
              type="text"
              class="form-control"
              id="title"
              name="title"
              placeholder="Enter alert title"
              required
            />
          </div>

          <div class="col-md-3">
            <label for="alert_type" class="form-label">Alert Type</label>
            <select class="form-select" id="alert_type" name="alert_type">
              {% for value, label in alert_types %}
              <option value="{{ value }}">{{ label }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-3">
            <label for="frequency" class="form-label">Frequency</label>
            <select class="form-select" id="frequency" name="frequency">
              {% for value, label in frequencies %}
              <option value="{{ value }}">{{ label }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-12">
            <label for="keywords" class="form-label"
              >Keywords (comma-separated)</label
            >
            <input
              type="text"
              class="form-control"
              id="keywords"
              name="keywords"
              placeholder="machine learning, deep learning, neural networks"
            />
          </div>

          <div class="col-12">
            <button type="submit" class="btn btn-gradient btn-lg">
              <i class="fas fa-bell me-2"></i>Create Alert
            </button>
          </div>
        </form>
      </div>

      <!-- Active Alerts Section -->
      {% if alerts %}
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>
          <i class="fas fa-list me-2"></i>Your Alerts ({{ alerts.count }})
        </h4>
      </div>

      <div class="row">
        {% for alert in alerts %}
        <div class="col-lg-6 mb-4">
          <div
            class="card alert-card {% if not alert.is_active %}inactive{% endif %}"
          >
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-start mb-3"
              >
                <h5 class="card-title mb-0">{{ alert.title }}</h5>
                <div class="d-flex align-items-center">
                  <!-- Toggle Switch -->
                  <form method="post" class="me-2">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="toggle" />
                    <input
                      type="hidden"
                      name="alert_id"
                      value="{{ alert.id }}"
                    />
                    <label class="alert-status-toggle">
                      <input
                        type="checkbox"
                        {%
                        if
                        alert.is_active
                        %}checked{%
                        endif
                        %}
                        onchange="this.form.submit()"
                      />
                      <span class="slider"></span>
                    </label>
                  </form>

                  <!-- Delete Button -->
                  <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete" />
                    <input
                      type="hidden"
                      name="alert_id"
                      value="{{ alert.id }}"
                    />
                    <button
                      type="submit"
                      class="btn btn-outline-danger btn-sm"
                      onclick="return confirm('Delete this alert?')"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </div>
              </div>

              <div class="mb-3">
                <span class="alert-type me-2"
                  >{{ alert.get_alert_type_display }}</span
                >
                <span class="alert-frequency"
                  >{{ alert.get_frequency_display }}</span
                >
              </div>

              {% if alert.keywords %}
              <div class="mb-2">
                <strong>Keywords:</strong>
                <div class="mt-1">
                  {% for keyword in alert.keywords|slice:":100" %}
                  <span class="badge bg-secondary me-1">{{ keyword }}</span>
                  {% endfor %}
                </div>
              </div>
              {% endif %}

              <div class="row text-muted small">
                <div class="col-6">
                  <i class="fas fa-calendar-alt me-1"></i>
                  Created: {{ alert.created_at|date:"M d, Y" }}
                </div>
                <div class="col-6">
                  {% if alert.last_triggered %}
                  <i class="fas fa-clock me-1"></i>
                  Last triggered: {{ alert.last_triggered|date:"M d, Y" }} {%
                  else %}
                  <i class="fas fa-info-circle me-1"></i>
                  Never triggered {% endif %}
                </div>
              </div>

              {% if not alert.is_active %}
              <div class="mt-2">
                <small class="text-warning">
                  <i class="fas fa-pause-circle me-1"></i>
                  This alert is currently inactive
                </small>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <!-- No Alerts State -->
      <div class="text-center py-5">
        <div class="mb-4">
          <i
            class="fas fa-bell-slash"
            style="font-size: 4rem; color: #dee2e6"
          ></i>
        </div>
        <h4 class="text-muted">No Research Alerts Yet</h4>
        <p class="text-muted mb-4">
          Create your first alert above to get notified about new research in
          your areas of interest.
        </p>
        <div class="alert alert-info">
          <h6><i class="fas fa-lightbulb me-2"></i>Pro Tips:</h6>
          <ul class="list-unstyled mb-0">
            <li>• Use keyword alerts to track emerging research topics</li>
            <li>• Set up author alerts to follow specific researchers</li>
            <li>
              • Monitor journals for the latest publications in your field
            </li>
            <li>• Get citation alerts when your work is referenced</li>
          </ul>
        </div>
      </div>
      {% endif %}

      <!-- Alert Statistics -->
      {% if alerts %}
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-bar me-2"></i>Alert Statistics
              </h5>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-md-3">
                  <div class="mb-2">
                    <h3 class="text-primary">{{ alerts.count }}</h3>
                    <p class="text-muted mb-0">Total Alerts</p>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="mb-2">
                    <h3 class="text-success">{{ alerts|length }}</h3>
                    <p class="text-muted mb-0">Active Alerts</p>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="mb-2">
                    <h3 class="text-info">0</h3>
                    <p class="text-muted mb-0">Triggered Today</p>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="mb-2">
                    <h3 class="text-warning">0</h3>
                    <p class="text-muted mb-0">Pending Alerts</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Auto-hide success messages after 5 seconds
    const alerts = document.querySelectorAll(".alert-dismissible");
    alerts.forEach(function (alert) {
      setTimeout(function () {
        const bsAlert = new bootstrap.Alert(alert);
        bsAlert.close();
      }, 5000);
    });

    // Add confirmation for delete actions
    const deleteButtons = document.querySelectorAll(
      'button[onclick*="confirm"]'
    );
    deleteButtons.forEach(function (button) {
      button.addEventListener("click", function (e) {
        if (
          !confirm(
            "Are you sure you want to delete this alert? This action cannot be undone."
          )
        ) {
          e.preventDefault();
        }
      });
    });

    // Enhance the alert type selector with descriptions
    const alertTypeSelect = document.getElementById("alert_type");
    if (alertTypeSelect) {
      alertTypeSelect.addEventListener("change", function () {
        const descriptions = {
          keyword:
            "Get notified when papers containing specific keywords are published",
          author:
            "Follow specific researchers and get alerts for their new publications",
          journal: "Monitor specific journals for new publications",
          citation: "Get notified when your work is cited by other researchers",
          conference:
            "Stay updated on specific conference proceedings and papers",
        };

        // You could show description tooltips or help text here
        console.log("Selected:", this.value, "-", descriptions[this.value]);
      });
    }
  });
</script>
{% endblock %}
